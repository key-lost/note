# 1 中间人代理mitmproxy
## 1.1 参考
- [mitmproxy教程(转载) - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/371209542?utm_id=0)
- [手机app数据的爬取之mitmproxy安装教程_wx5bbc67ce7b2af的技术博客_51CTO博客](https://blog.51cto.com/u_14011026/6444525)
## 1.2 使用
1. 使用pip3 install mitmproxy安卓可以拥有`mitmproxy`、`mitmdump`、`mitmweb` 三个命令和Python的定制包，去官网下载只会得到工具
2. mitmproxy命令可提供一个命令行界面实时获取请求，并通过命令筛选请求![[Pasted image 20230907164817.png]]
3. mitmweb命令会打开一个网页，通过gui交互过滤请求 ![[Pasted image 20230907164942.png]]
# 2 FridaHook辅助算法分析
## 2.1 作用
1. 找到一些疑似关键函数，可以通过hook来确认app执行某个操作的时候，是否调用了它们

2. 如果没有触发这些函数，考虑以下问题
    -  app在执行这个操作的时候，真的没有调用这个函数，换一个其他的关键函数
    - 代码写错了，导致hook函数没执行
    -  一般可以通过主动调用上层函数，来触发这些hook函数
3. 如果触发了这些函数，可以通过hook来打印执行过程中传入函数的参数和返回值
4. frida -U -F -l HookDemo.js
    - -U 代表远程USB设备
    - -F 代表附加到最前的这个app
    - -l 后面指明需要加载的JS脚本

5. 写好的js脚本要注入手机端，并不是在Node.js中使用，所以只能用v8和fridaAPI支持的代码
# 3 关键代码快速定位
1. HashMap的put方法
```
	 var hashMap = Java.use("java.util.HashMap");
    hashMap.put.implementation = function (a, b) {
        if(a.equals("username")){
            showStacks();
            console.log("hashMap.put: ", a, b);
        }
        return this.put(a, b);
    }
```
 1. ArrayList的add、addAll、set方法等
```
	var arrayList = Java.use("java.util.ArrayList");
	arrayList.add.overload('java.lang.Object').implementation = function (a) {
	   if(a.equals("username=15968079477")){
        showStacks();
        console.log("arrayList.add: ", a);
	    }
    //console.log("arrayList.add: ", a);
    return this.add(a);
	}
	arrayList.add.overload('int', 'java.lang.Object').implementation = function (a, b) {
    console.log("arrayList.add: ", a, b);
    return this.add(a, b);
	}

```
# 4 frida相关api详解